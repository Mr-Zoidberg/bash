# vim: ft=sh sw=2 ts=2 expandtab

# gg goes to root projects folder (this alias has historical reasons)

_CURRENT_DIR_FOR_GG=$([[ -f ~/.ggdir ]] && cat ~/.ggdir || echo -n ~/Projects)

gg() { cd ${_CURRENT_DIR_FOR_GG}/$1; }

# it cd to a given project or the root of all projects
_complete_projects() {
  local cur
  cur=${COMP_WORDS[COMP_CWORD]}
  subs=`expr "${_CURRENT_DIR_FOR_GG}" : ".*\/\(.*\)" `
  COMPREPLY=( $( compgen -S/ -d ${_CURRENT_DIR_FOR_GG}/$cur | sed s/.*${subs}.// ) )
}

# setting autocomplete for 'gg' alias
complete -o nospace -F _complete_projects gg

# force load from file
fsetgg() { setgg $(cat ~/.ggdir); }

# inspect which dir is in ggdir file
fgetgg() { cat ~/.ggdir; }

# shows current base dir for gg
getgg() {
  echo ${_CURRENT_DIR_FOR_GG}
}

# allows you to change the base dir for gg
setgg() {
  local t_dir=${1:-~/Projects}
  t_dir=${t_dir%*/} # remove trailing slash, it mess with complete
  echo ${t_dir} > ~/.ggdir # persist dir for gg for new shells
  _CURRENT_DIR_FOR_GG=${t_dir}
  getgg
}
